@page "/login"
@inject Blazored.LocalStorage.ILocalStorageService iLocalStorage
@inject NavigationManager NavigationManager

@using Supermercado.Data
@using Supermercado.DAO

<div class="row">
    <div class="col-md-4">
        <section>
            <form class="form-group">
                <h4>Digite sus credenciales para iniciar sesion</h4>
                <hr />
                <div asp-validation-summary="All" class="text-danger"></div>
                <div class="form-group">
                    <label for="username">Nombre de Usuario</label>
                    <input @bind="username" type="text" class="form-control" required />

                </div>
                <div class="form-group">
                    <label for="password">Contrasenia</label>
                    <input @bind="password" type="password" class="form-control" required />
                </div>
                <div class="form-group">
                    <button @onclick="iniciarSesion" type="submit" class="btn btn-primary">Iniciar Sesion</button>
                </div>
            </form>
        </section>
    </div>
</div>

@code{

}

@code{
    Usuario user = new Usuario();
    private string username;
    private string password;

    private void iniciarSesion()
    {
        if (username != null && password != null)
        {
            CRUD crud = new CRUD();
            user = crud.validateCredentials(username, password);
            if (user != null)
            {
                SaveSession();
                NavigationManager.NavigateTo("/counter", forceLoad: true);
            }
        }
        else return;


    }

    Usuario userSessionValue = new Usuario();
    string Message = "";

    protected override async Task OnInitializedAsync()
    {
        userSessionValue = await iLocalStorage.GetItemAsync<Usuario>("SessionValue");

    }

    public async void SaveSession()
    {
        Message = "Session Saved";
        await iLocalStorage.SetItemAsync("SessionValue", user);
    }

}